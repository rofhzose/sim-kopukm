# ==========================================
# ğŸ§± Gunakan Node versi stabil (ringan + cepat)
# ==========================================
FROM node:20-alpine AS base

# ==========================================
# ğŸ“‚ Set working directory di container
# ==========================================
WORKDIR /app

# ==========================================
# âš™ï¸ Salin file package.json & package-lock.json
# ==========================================
COPY package*.json ./

# ==========================================
# ğŸ“¦ Install dependencies (tanpa devDependencies)
# Gunakan retry agar stabil di koneksi VPS
# ==========================================
RUN npm config set fetch-retries 5 \
    && npm config set fetch-retry-factor 2 \
    && npm config set fetch-retry-maxtimeout 60000 \
    && npm install --omit=dev

# ==========================================
# ğŸ“ Copy semua source code backend
# ==========================================
COPY . .

# ==========================================
# âš™ï¸ Jalankan sebagai user node (tanpa chown berat)
# ==========================================
USER node

# ==========================================
# ğŸŒ Expose port backend API
# ==========================================
EXPOSE 4849

# ==========================================
# ğŸš€ Jalankan aplikasi Node.js
# ==========================================
CMD ["node", "server.js"]
