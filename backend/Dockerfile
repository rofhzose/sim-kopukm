# ==========================================
# ğŸ§± Gunakan Node versi stabil
# ==========================================
FROM node:20-alpine AS base

# ==========================================
# ğŸ“‚ Set working directory di container
# ==========================================
WORKDIR /app

# ==========================================
# ğŸ“¦ Copy file package.json dan package-lock.json
# ==========================================
COPY package*.json ./

# ==========================================
# âš™ï¸ Install dependencies (hanya production)
# ==========================================
RUN npm ci --omit=dev

# ==========================================
# ğŸ“ Copy seluruh source code backend
# ==========================================
COPY . .

# ==========================================
# âš™ï¸ Jalankan sebagai user node (aman tanpa chown)
# ==========================================
USER node

# ==========================================
# ğŸŒ Expose port API
# ==========================================
EXPOSE 4849

# ==========================================
# ğŸš€ Jalankan app (tanpa nodemon)
# ==========================================
CMD ["node", "server.js"]
